<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://brl-cad.github.io/wiki/ESA_Summer_of_Code_in_Space/Geometry_Viewer_Application_for_BRL-CAD/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Geometry Viewer Application for BRL CAD - BRL-CAD Wiki</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">BRL-CAD Wiki</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../code/" class="nav-link">Code</a>
                            </li>
                            <li class="navitem">
                                <a href="../../tasks/" class="nav-link">Tasks</a>
                            </li>
                            <li class="navitem">
                                <a href="../../users/" class="nav-link">Users</a>
                            </li>
                            <li class="navitem">
                                <a href="../../docs/" class="nav-link">Docs</a>
                            </li>
                            <li class="navitem">
                                <a href="../../pdf/" class="nav-link">PDFs</a>
                            </li>
                            <li class="navitem">
                                <a href="../../misc/" class="nav-link">Misc</a>
                            </li>
                            <li class="navitem">
                                <a href="../../talks/" class="nav-link">Talks</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/BRL-CAD/wiki/blob/main/pages/ESA_Summer_of_Code_in_Space/Geometry_Viewer_Application_for_BRL-CAD.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#outline" class="nav-link">Outline</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#status-15082016" class="nav-link">Status (15.08.2016)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#task-breakdown" class="nav-link">Task Breakdown</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#task-list" class="nav-link">Task list</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#project-workflow" class="nav-link">Project Workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><font size="5"><strong>European Summer of Code 2016</strong></font></p>
<p>Mentor: <strong>Christopher Sean Morrison</strong></p>
<p>Student: <a href="../../user/Asadmorgoth/">Asad</a></p>
<p>This document lists down the design for the project. This includes the
major milestones and deadlines. <a href="https://onedrive.live.com/redir?page=view&amp;resid=A5975CC7CB592FF3!1807&amp;authkey=!ACJF7aDRbNZlIIA">Prettier
Version</a></p>
<hr />
<h2 id="outline">Outline</h2>
<p>The idea is to build a geometry viewer application that generates a
standalone double-clickable file that views a given model. The approach
is to concatenate the contents of a given “.g” file with the function
calls from librt and display a “.g” file, in a standard brlcad setup.</p>
<p>Our source code will generate an executable, we will then separately
concatenate a ".g" file into this executable:</p>
<p>This executable is capable of:</p>
<ol>
<li>Finding the start of ".g" file bytes/headers</li>
<li>Populating the g file database for librt</li>
<li>Plotting the items in the g file using
    <a href="http://www.glfw.org/docs/latest/pages.html">glfw3</a>.</li>
</ol>
<p>Our motivation is to introduce portability and ability to share results
of brlcad via email with users who don’t have brlcad setup in their
environments. First we will develop a standalone application but later
this can be integrated into mged or any other tool as a brlcad feature.</p>
<h2 id="status-15082016">Status (15.08.2016)</h2>
<p>Our source code takes an embedded .g file and locates it's header bytes
from there on it calls db_open() by writing the gbytes into a temporary
file and populates struct db_i. The source also calls db_ls to get a
count of objects in the database and calls db_walk_tree on one of the
objects. Then work a list of all top level objects is fetched via db_ls
and then db_walk_tree is called on each of them. The next step is to
plot these zones, for this purpose we have decided to choose
<a href="http://www.glfw.org/docs/latest/pages.html">glfw3</a>. Currently the work
is being done to generate a simple window from our application using
glfw.</p>
<h2 id="task-breakdown">Task Breakdown</h2>
<p>The brlcad suite has many tools and libraries that interact with each
other to render and view models. The general architecture is given
below:
<img alt="" src="../../doc/img/Data_flow_structure.png" /></p>
<p>The most important part for us out of this architecture is the geometry
rendering libraries, to be more specific librt &amp; libdm.</p>
<p>•
<a href="http://brlcad.sourceforge.net/doxygen/da/d12/group__librt.html"><strong>Librt</strong></a>,
the library that contains all of the geometry support. It parses the
“.g” file and its function calls can be used to extract contents of “g”
file. We will use this to parse our model file for Libdm. The relevant
function call is “db_open”. There is also possibility to use a higher
level library “libged” (ged_open)</p>
<p>•
<a href="http://brlcad.org/docs/doxygen-r64112/d4/de4/group__libdm.xhtml"><strong>Libdm</strong></a>
is BRL-CAD's primary graphics display manager (dm) library. It is used
to display geometry in GUI. This will be utilized by our source to
visualize model files.</p>
<p>This resulting draw result will then be bundled into an executable
(Linux) and later into packages for Mac &amp; Windows.</p>
<h2 id="task-list">Task list</h2>
<p>1. Evaluate technology to be used</p>
<ul>
<li><s>Develop initial project design draft</s> [DONE]</li>
<li><s>Setup development environment</s> [DONE]</li>
</ul>
<!-- -->

<ul>
<li>
<ul>
<li><strong>Installing BRLCAD:</strong> (<a href="http://svn.code.sf.net/p/brlcad/code/brlcad/trunk/INSTALL"><strong>Install
        Instructions</strong></a>)</li>
</ul>
</li>
</ul>
<p><strong>System Specs:</strong> CentOS 7, Dual Core, 4G RAM, 40 G Storage</p>
<pre><code class="language-bash"># Fetch the STABLE version of BRLCAD (7.24.4):
svn checkout http://svn.code.sf.net/p/brlcad/code/brlcad/branches/STABLE/ brlcad-stable

cd brlcad-stable

mkdir brlcad-build

cd brlcad-build

cmake ../ -DBRLCAD_BUNDLED_LIBS=ON -DCMAKE_BUILD_TYPE=Release -BRLCAD_ENABLE_STRICT=OFF

# Without enable strict we get an error: &quot;array subscript is above array bounds&quot; during make

make -j6

make install

vim ~/.bash_profile

# Add &quot;/usr/brlcad/rel-7.24.4/bin&quot; to PATH.

vim brlcad-7.24.4.conf

# Add &quot;/usr/brlcad/rel-7.24.4/lib&quot;

ldconfig
</code></pre>
<ul>
<li>Evaluate programming language choice (C decided, for GUI may use
    some Python)</li>
</ul>
<p>2. Evaluate and look into current viewer applications:</p>
<ul>
<li>Mged / archer</li>
<li>Isst, it doesn’t use libdm.</li>
<li>Geometry viewer <a href="https://github.com/BRL-CAD/geometry_viewer">1</a></li>
</ul>
<p>3. Create Compiler Application:</p>
<p>First step is to merge .g file into executable and then read it's
contents. This is achieved by simply concatenating .g file with
executable using the Linux "cat" command e.g., <strong>cat viewer moss.g &gt;
exec</strong>.</p>
<p>Then we locate the header bytes (hex) of the embedded .g file from
within the executable. From "hexdump" command we can conclude that .g
files have the bytes <strong>(76 01 00 00 00 00 01 35)</strong> in common:</p>
<pre><code class="language-bash">hexdump -C build/share/db/wave.g | head
00000000  76 01 00 00 00 00 01 35  76 02 00 00 00 00 0a 00  |v......5v.......|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000050  00 00 00 00 00 00 00 35  76 02 00 00 00 00 02 00  |.......5v.......|
00000060  00 00 00 00 00 00 00 35  76 20 00 20 01 04 1a 06  |.......5v . ....|


00000070  62 61 73 65 31 00 c0 40  82 c0 00 00 00 00 00 c0  |base1..@........|
</code></pre>
<p>Once the bytes have been located we have the option of either:</p>
<ul>
<li>
<ul>
<li>Populating <a href="http://brlcad.org/docs/doxygen-r64112/d2/d66/structdb__i.xhtml"><strong>struct
        db_i</strong></a>
        manually</li>
<li>Getting a file descriptor of bytes in memory and passing it on
    to
    <a href="http://brlcad.org/docs/doxygen-r64112/d3/d9b/group__dbio.xhtml#gaa9eb8edb99fa1da5d188587e07d8dacc"><strong>db_open</strong></a>.</li>
</ul>
</li>
</ul>
<p>4. Create application Interface with librt</p>
<p>Librt is used to open brlcad geometry files and edit them. It reads a .g
file by calling the function
<a href="http://brlcad.org/docs/doxygen-r64112/d3/d9b/group__dbio.xhtml#gaa9eb8edb99fa1da5d188587e07d8dacc"><strong>db_open</strong></a>
and populates a <a href="http://brlcad.org/docs/doxygen-r64112/d2/d66/structdb__i.xhtml"><strong>db_i
structure</strong></a>.
To view the geometry files we need
<a href="http://brlcad.org/docs/doxygen-r64112/d4/de4/group__libdm.xhtml"><strong>Libdm</strong></a>
which takes this db_i structure as input to do so.</p>
<p>As we have located the g file bytes, we simply write out these bytes
onto a temporary file and pass this file onto db_open(). db_open then
populates the database structure db_i. An
<a href="../../doc/Example_db_walk_tree/"><strong>example</strong></a> is already available that shows
the usage of db_open. We are utilizing the skeleton of this example to
populate the struct db_i. A cleaner approach would be to directly
populate the struct db_i and I am working on that.</p>
<p>The next step is to identify the top level objects of a g file. These
can be listed by issuing a "tops" command on mged after opening a g
file. In code this can be achieved by following db_ls and/or
DB_LS_TOPS in src/libged/*.c.</p>
<p>After these top level objects have been identified we need to call
<a href="http://brlcad.sourceforge.net/doxygen/d3/d9b/group__dbio.html#ge69d8a8eb90d514e554e1b84bbb7018f">db_walk_tree</a>
on each of them.</p>
<p>5 Plot the Model using GLFW</p>
<p>GLFW is basically a library to use with OpenGL, to aid in the creation
of graphical windows and some other stuff. The plan is to use this
library to open up a simple window and then plot all the members of the
g file into this window.</p>
<p>6. Develop front end</p>
<ul>
<li>Develop Single window view</li>
<li>Develop File Input</li>
</ul>
<p>7. Write Functional testing test cases.</p>
<h2 id="project-workflow">Project Workflow</h2>
<ul>
<li>This design document will be updated regularly to include the status
    of tasks as well as any changes in project scope and/or approach.</li>
<li>The source will be uploaded on:
    <a href="https://github.com/asadpiz/brlcad-viewer">2</a></li>
<li>There will also be occasional weekly status meetings on irc
    <strong>#brlcad</strong> (Fridays 16:00 GMT+2)</li>
</ul>
<h2 id="references">References</h2>
<p><a href="../../doc/pdf/Application_Development.pdf">3</a>
<a href="http://brlcad.sourceforge.net/doxygen/modules.html">4</a>
<a href="http://brlcad.org/docs/doxygen-r64112/index.xhtml">5</a>
<a href="http://brlcad.org/docs/doxygen-r64112/d2/d66/structdb__i.xhtml">6</a>
<a href="http://brlcad.org/docs/doxygen-r64112/d3/d9b/group__dbio.xhtml#gaa9eb8edb99fa1da5d188587e07d8dacc">7</a>
<a href="http://brlcad.org/docs/doxygen-r64112/d0/d0a/ged_8c_source.xhtml#l00420">8</a>
<a href="http://brlcad.org/docs/doxygen-r64112/dc/ddd/osg-test_8cpp_source.xhtml#l00588">9</a>
<a href="http://en.flossmanuals.net/contributors-guide-to-brl-cad/appendix-iii-further-references-and-resources/">10</a>
<a href="http://svn.code.sf.net/p/brlcad/code/brlcad/trunk/HACKING">11</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
