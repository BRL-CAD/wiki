<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://brl-cad.github.io/wiki/user/EBautu/More_Changelog/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>More Changelog - BRL-CAD Wiki</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">BRL-CAD Wiki</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../code/" class="nav-link">Code</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../tasks/" class="nav-link">Tasks</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../users/" class="nav-link">Users</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../docs/" class="nav-link">Docs</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../pdf/" class="nav-link">PDFs</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../misc/" class="nav-link">Misc</a>
                            </li>
                            <li class="navitem">
                                <a href="../../../talks/" class="nav-link">Talks</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a href="https://github.com/BRL-CAD/wiki/blob/main/pages/user/EBautu/More_Changelog.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#april-20-may-23-bonding-period" class="nav-link">April, 20 – May, 23 - Bonding period</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#may-25-july-10-coding-period" class="nav-link">May, 25 – July, 10 - Coding period</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#may-23-june-2" class="nav-link">May, 23 - June, 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#june-3-june-10" class="nav-link">June, 3 - June, 10</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#june-11-june-16" class="nav-link">June, 11 - June, 16</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#june-17-july-6" class="nav-link">June, 17 - July, 6</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#july-7-31" class="nav-link">July 7 - 31</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#august-3-today" class="nav-link">August 3-Today</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p><a href="category:_Summer_of_Code.md">category: Summer of Code</a> This is
the changelog for <a href="http://more.brlcad.org">more.brlcad.org</a> GSoC
project. The project plan and specification is located
<a href="/wiki/user/EBautu">here</a>.</p>
<h1 id="april-20-may-23-bonding-period">April, 20 – May, 23 - Bonding period</h1>
<p>During this period I got to know better Cliff, Sean and other BRL-CAD
comunity members and GSoC students.</p>
<p>I used <a href="http://drupal.org/forum">Drupal forums</a> to gather some
information about what others with similar projects have done, what
modules have they used and how. It seems that most of similar projects
used CCK and views to power most of the site features, with some modules
specific to their content (audio, content, etc). Therefore, I plan to
use CCK and views, too and to suplement those with the custom modules
I'll create for handleing BRL-CAD models task.</p>
<p>During discussions with Sean, Cliff and Erik, some of the features were
left out, while others were promoted. Among the most import issues
pointed out were (sorted by importance, from most important to less):</p>
<ul>
<li>model licensing</li>
<li>import cad geometry (at least .g files, maybe more)</li>
<li>export .g files</li>
<li>browsing &amp; searching</li>
<li>queing operations (conversions, raytracing, etc)</li>
<li>multiple upload methods (some model files could be bigger than
    '1GB')</li>
</ul>
<p>This period was also good for reading some more information about the
many BRL-CAD tools, since I'll have to use many of them in the second
part of the project.</p>
<h1 id="may-25-july-10-coding-period">May, 25 – July, 10 - Coding period</h1>
<p>During this period I have to do initial setup of more.brlcad.org with
Drupal and whatever existing modules I could reuse and select/adapt the
site theme of more.brlcad.ord.</p>
<h2 id="may-23-june-2">May, 23 - June, 2</h2>
<p>I got an account on brlcad.org with mysql, SVN, SSH access and all the
tools/access rights fast and easy. I started out by installing Drupal
and some models: CCK, Views, captcha, flag, pathauto, token.</p>
<p>I decided to use Drupal 5 for various reasons: it's used by brlcad.org,
I'm more familiar with it (and contrib modules for it), I'm not very
fond of D6, there are more modules available for it. Not all modules I'm
using were commited/enabled from the begining; first I like to make sure
they work as advertised and that they are useful to me; for others, I
didn't know they existed and I added them later.</p>
<p>Also, after a long period of testing and (subjective) comparing many
themes, I have finally made up my choice about the site's theme. It's
<a href="http://drupal.org/project/fireflystreamcom">FireflyStream</a>! I like it
very much because it's very light (color and code-wise) - my oppinion.
I'll probably need to change the logo (maybe one of Cliff's tires).</p>
<p>I also updated codebase for www.brlcad.org and its modules. During this
process, I cleaned up the Drupal modules and themes directories (by
moving non-core entries in other places) and installed new modules in
sites/all/modules (as recommended by Drupal). This makes later upgrades
easier.</p>
<p>With some additional configuration the new captcha module (version 3) is
able to add captcha points to the site contact form, something that Sean
and I talked about some time ago :)</p>
<p>Meanwhile, I got a database dump and the zipped code from the main site
and created a testing environment on my PC. This way I can test things
safer and easier and independently of whether my Internet connections is
working or not.</p>
<h2 id="june-3-june-10">June, 3 - June, 10</h2>
<p>I tried two ways of implementing licensing: node type and CCK node
reference or taxonomy and terms. The advantage of taxonomy solution is
its lightweight and the easily ability to produce tag coulds from it.
However, it has limited features and posibilities for customization. I'm
not sure right now how far this licensing issue will go, so I'd like to
have some freedom. As thing will move on, maybe I'll come back to this
solution, but for now...</p>
<p>I decided to define a new content type for licenses (in addition to the
one I used for models). Then I setup models to require a single
node-referenced license. This will force users to select one of the
licences we support when submitting a model.</p>
<p>Cliff adviced me to start with some already existing open-source
licenses, like GPL. I think it's a good way to do it, because it's
easier to add new licences in the future that it could be to drop one
license and the reassign its models.</p>
<p>For reporting license problems, first I wanted to use the
<a href="http://drupal.org/project/abuse">abuse</a> module. However, it's still in
beta and someone advised me to look at a more feature-rich module,
called flag.</p>
<p>Using the flag module I defined a new type of tagging, which will allows
users to report whenever they notice a license infringement. The
administrators can retrive a list of the marked models in order to check
the report.</p>
<p><em>TODO: I think I could integrate this tagging with CIA notifications, so
that messages are sent when content is tagged.</em></p>
<h2 id="june-11-june-16">June, 11 - June, 16</h2>
<p>I installed and configured the pathauto, token, imagefield, filefield
and nodequeue modules. These will allow the site to use user friendly
addreses. I decided to use the following patterns for content:</p>
<ul>
<li>pages: content/title-raw</li>
<li>licenses: license/title-raw</li>
<li>models: model/title-raw</li>
<li>stories: news/yyyy/mm/dd/title-raw</li>
<li>users: user/username</li>
</ul>
<p>I'll probably need soon the token module for the custom modules I'm
working on (to create the model preview images).</p>
<p>The last days I've been checking out some WYSIWYG editors modules for
Drupal. There are many out there, although it seems that lately, many of
them have converged towards the <a href="http://drupal.org/project/wysiwyg">WYSIWYG
API</a> module. Mainly, I focused on
testing and comparing browser compatibility and features for the
FCKeditor, TinyMCE, HTMLArea (using Xinha), widgeditor, and some others.</p>
<p>The most complete/complex editor was probably TinyMCE. It has many
features and plugins. However, once enabled, it seemed to be too much
for the simple model descriptions: most users will probably to very
little formatting. Also, all these features have with some weights
(bigger files and longer loading times). The same thing goes for
FCKEditor (which also presented some formatting issues) and Xinha (which
has some issues with Opera). On the hand, some other modules (like
BUEditor) are too simple and don't seem to help very much in editing
your content.</p>
<p>In the end, I decided that widgeditor offers the best balance between
features and lightweightness, so we'll stick with it for now.</p>
<h2 id="june-17-july-6">June, 17 - July, 6</h2>
<ul>
<li>June 17 - I tryed to find a module that allows FTP uploaded files to
    be included in filefields. I found filefield sources module that
    does something similar, but not exactly, it's still beta and only
    available for Drupal 6. I also found a forum post from the filefield
    author saying this feature is not suported and will never be (unless
    commissioned as a payed job). So I decided to implement it myself by
    modifing the filefield module. Meanwhile, I also started to commit
    the other modules I'll use and tomorow I'll copy the database from
    my PC to the server.</li>
<li>June 18 - I finished implementing the local file selection features.
    This means that model files can be uploaded via the web form or FTP
    (and later selected). The file selection uses AJAX (when available)
    to present a list of potential selection. I also finished uploading
    all the modules. I lost some time struggleling nodequeue because
    some files had different line endings (Unix, DOS and MacOS) and were
    rejected.</li>
<li>June 19 - I finished bringing everything on the live server. For the
    theme, I fixed some small bugs. I have created a site logo using the
    humvee from the BRL-CAD gallery and customized the maintenance page.</li>
<li>June 20 - I started working on the custom modules for integration
    with BRL-CAD.</li>
<li>June 21 - June 28 - I was away to Iasi to attend and give a talk at
    the summer school ECODAM 2009 (focused on applications of
    Evolutionary Computation in optimisation and data-mining). In the
    few spare moments I got, I refined the design of the custom modules
    for integration. They will use mged with custom scripts to perform
    actions on models.</li>
<li>June 29 - I worked on the BRL-CAD code for raytracing models.</li>
<li>June 30 - I tested (a bit unsuccessfully) various mged commands to
    retrieve metadata from models. I seems that mged outputs to data to
    stderr instead of stdout and when supplying 2 commands separated by
    ; only the last gets executed. Erik said this looks like bugs. I was
    unable to get a command to list the trees of the top objects (eval
    tree [tops] doesn't work). I also worked on an attempt to
    implement a multistep model submission form. This seems the only
    approach to allow users to select which objects to render.</li>
<li>July 1 - I finally realized that mged actually supports fully Tcl
    syntax. I started learning basic Tcl and writing the integration
    scripts for object hierarchy retrieval and metadata retrieval. The
    custom module will autodetect and support multiple BRL-CAD versions
    though using these scripts.</li>
<li>July 2 - I implemented a connector to PHP through Tcl scripts and
    redirects, and I started implementing scripts (metadata until now).</li>
<li>July 3 - Metadata retriving is completed (tcl scripts and Drupal
    code). For now I store title, db version, units and summary, but
    this can be extended with other information since it has the
    customizable tcl scripts.</li>
<li>July 4 - I rewrote the php-mged integration part to use
    proc_open/proc_close functions instead of exec. This allows more
    flexibility, including parameter pass between PHP and mged. I
    implemented the raytracing scripts and code. Last couple of hours I
    try without success to fix a bug in filefield module that prevents
    proper cleanup of unused files.</li>
<li>July 5 - A lot of things got done today: I fixed the bug in the
    filefield module; I implemented the queueing process (twice, first
    with nodequeue, then with flag); I added some tags for models; I
    optimized and improved the thumbnail generation process (now allows
    customized and automatically generated images) and added a thickbox
    gallery for them; I customized some aspects of the theme; I ported
    everything on mode.brlcad.org and ``Erik helped me by installing
    the lasted brlcad version.</li>
<li>July 6 - I fixed some bugs. I copied everything on more.brlcad.org
    and submited two models live for testing. I noticed some more bugs
    on more.brlcad.org (raytrace images are created in the wrong
    directory and title is not retrieved correctly). I fixed the later
    one.</li>
</ul>
<h2 id="july-7-31">July 7 - 31</h2>
<ul>
<li>July 7 - I started looking at the other features that I have to
    implement: better browsing/search, better model theming, allow users
    to select the raytracing objects, multiple formats.</li>
<li>July 8 - Today had less time to work, but I focused on the model
    theming. Especially the teaser of the model should provide enough
    information to attract the user. This now includes the thumbnail
    image of the first (which should be more appropriate one, not just
    the top one).</li>
<li>July 10 - Yesterday and today I did some experiments with multistep
    forms in order to allow users to select which object to show in the
    images. I'm not very happy with the solution I got so far, so I'll
    have to work some more on it. The main problem is that multistep
    submissions are not very easy to implement in drupal. I foresee the
    same problem (maybe harder) will arrise when implementing the
    multiple format upload and conversion.</li>
<li>July 14 - Last two day I started to implement the object selection
    for raytracing. In order to do that, I had to reimplement the
    php-mged interface in order to support multiline outputs. I needed
    this feature in order to retrieve the list of the objects in the
    database (and their features). I'm also testing a rewrite of the
    raytracing feature because after some talks with ``Erik (he
    mentioned that for realy large databases, loading in mged can take a
    few minutes). If this works, metadata extraction and raytracing will
    be done by a single script, starting mged only once per database.</li>
<li>July 17 - I finished implementing the new php-mged interface which
    allows to extract model metadata and create all raytracing of a
    model with a single call to mged. This should improve performance
    for raytracing large models or doing many raytraces on a single
    model.</li>
<li>July 18 - I finished implementing object selection for rendering.
    The user can select which objects from the model file will be drawed
    before raytracing. In order to do this, I developed a new model that
    allows displaying multicolumn select lists. I also extended the
    filefield and imagefield modules to allow the use of the Node Id in
    the path. This will solve the problem of images being saved in a
    single directory.</li>
<li>July 20-21 - I started working on conversion. According to initial
    chat with Starseeker and Brlcad, the original file that the user
    submitted should still be available after conversion. Also, another
    request is to make the conversion part of the off-line queue-based
    processing system. I created a new CCK filefield for the original
    submitted file and now I'm implementing the conversion and system.</li>
<li>July 22-23 - I don't know what happened with the activity log for
    these two days. I'm pretty sure I submitted it and watched it show
    up, but now I don't see it anymore. Maybe I clicked preview instead
    of save and then I closed the browser. Basicly I worked on the
    conversion code.</li>
<li>July 24 - Wow! I worked all day, did a lot of code cleanup,
    refactoring, and in the end, I implemented the conversion from/to
    BRLCAD file. Works really nice, I'll port it on the server on
    Monday.</li>
<li>July 25 - I added automatic detection for supported file formats.
    Now, when you create a new file field named forma_file (where
    format is a supported BRLCAD format), models will be automatically
    converted to that field. I implemented a new script system and I
    added fivestar ratings. There is still work to do on the theme and
    site browsing.</li>
<li>July 27-29 - I added various browsing features (by rating,
    popularity, etc). I implemented a very light download counter for
    model files, fixed some bugs in conversion code. I had to make some
    changes to the raytracing code because mged is starting rt in
    background (which creates problems with PHP IPC functions). I put
    everything live and started testing.</li>
<li>July 30 - I got the cianotify module I developed during the
    application period and implemented more features and settings. I'll
    use it to provide feedback in irc about site activity.</li>
<li>July 31 - I finished testing the cianotify module. I refined the
    model processing code so that new raytraced images are produces only
    if necesary. This reduces the reprocessing times with 80% on models
    of small-medium complexity.</li>
</ul>
<h2 id="august-3-today">August 3-Today</h2>
<ul>
<li>August 3-6 - I fixed a few bugs. I changed the licence from node to
    vocabulary because it's lighter and give more features (like
    tagcloud, models with the same licence), and changed the theming
    accordingly. I copied everything on production and setup CIA notify.</li>
<li>August 7-15 - I posted more example models on the site to check test
    it some more. I removed the readonly option from mged so that the
    model titles get displayed correctly (the problem is in the BRL-CAD
    version installed on the server, but it was fixed in CVS). I added
    service links and link back code on the model pages so that users
    can link back to us easily and votes on social sites the models they
    like. The service links are not displayed for visitors right now (I
    don't know why, but I'll fix it after GSoC final evaluation, so that
    I don't break the "pencils down" rule).</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js" defer></script>
        <script src="../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
